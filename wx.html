<!DOCTYPE html>
<html lang="en">
<head>
<meta name="google-site-verification" content="P6rqWS7FvCkbQVwIJLtztDsRWp4XSqEZeMLUkLn_MMo" />
<meta charset="UTF-8">
<title>Seamless Map ‚Äì Overlay Tab Left Middle, Info Panel Right Middle</title>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<style>
html, body { height:100%; width:100%; padding:0; margin:0; }
body { min-height:100dvh; }
body.dusk-mode .world-map {
    filter: brightness(1.08) sepia(0.08) hue-rotate(-13deg) saturate(1.22) contrast(1.09);
    background-color: #7e87c0!important;
}
body.day-mode .world-map {
    filter: brightness(1.13) contrast(1.16) sepia(0.03) hue-rotate(-7deg) saturate(1.25);
    background-color: #daf0ff!important;
}
/* Dusk and day mode related styling only */
body.dusk-mode .weather-panel  { background: #b3b6dbed; color: #263163; }
body.day-mode .weather-panel   { background: #fff; color: #232425; }
body.dusk-mode .overlay-controls { background:#b3b6dbce;}
body.day-mode .overlay-controls { background:#eefdffde; color:#222;}
body.dusk-mode .overlay-controls label,
body.day-mode .overlay-controls label{ color:#23242d;}
body.day-mode .location-marker { background:#ffe; color:#0069cc;}
body.dusk-mode .location-marker { background: #ece8ff; color: #464093;}
/* Other styles unchanged */
.map-container { position:relative; width:100vw; height:100vh; overflow:hidden; }
.map-viewport { width:100vw; height:100vh; overflow:hidden; position:relative; touch-action:none; }
.map-tiles-wrap {
    width:300vw; height:100vh;
    display:flex; position:absolute; top:0; left:0;
    will-change:transform;
    transition: transform 0.24s cubic-bezier(.68,-0.55,.27,1.55);
}
.map-tiles-wrap.dragging { transition:none; }
.world-map, .overlay-img {
    width:100vw; height:100vh; min-width:100vw; min-height:100vh;
    object-fit:cover; pointer-events:none; user-drag:none; user-select:none;
    position: absolute; left:0; top:0; transition: filter .22s, background-color .2s; z-index: 1;
}
.overlay-img { opacity: 0.7; pointer-events:none; z-index:10; }
.overlay-img.hidden { opacity:0 !important; }
.overlay-controls {
    position: fixed; left: 0; top: 50%; transform: translateY(-50%);
    z-index: 301; display: flex; flex-direction: column; gap: 6px;
    border-radius: 13px; padding: 8px;
}
@media (max-width: 700px) {
  .overlay-controls { left: 0; top: 50%; transform: translateY(-50%); padding: 5px; }
}
.overlay-controls label { font-size:14px; cursor:pointer;}
.top-buttons {
    position:absolute; top:0; left:0; width:100vw; display:flex; flex-wrap:wrap; gap:6px; z-index:100;
    align-items:center; background:linear-gradient(90deg,#242c3c 82%,#423877 100%);
    padding:7px 5px 4px 5px; box-sizing:border-box;
}
.mode-btn, button { border-radius:9px; border:2px solid #8882; cursor:pointer; font-weight:bold; font-size:1.1em; padding:7px 11px;}
#latLonInput, #placeInput { min-width:90px; width:25vw; max-width:150px; padding:7px; border-radius:7px; border:1px solid #aaa; color:#222; background:#eefdff;}
#cursorLatLon{ min-width:90px; padding:6px 10px; border-radius:7px; background:#eefdff; color:#222; font-family:monospace; font-size:14px;}
.location-marker {
    position: absolute;
    padding: 4px 8px; border-radius: 6px; font-size: 1.3em; transform: translate(-50%, -50%);
    border: 1px solid #ffc055; box-shadow: 0 1px 5px #ffbc3355; z-index: 150; max-width: 60vw;
}
#homeBtn { margin-left:auto; }
.weather-panel {
    position: fixed; right: 12px; top: 50%; transform: translateY(-50%);
    min-width: 200px; max-width: 38vw; border-radius: 12px;
    padding: 15px 18px 15px 20px; font-size: 1em;
    box-shadow: 0 3px 20px #193e7e88; z-index: 302;
    display: none; word-break: break-word;
}
@media (max-width: 700px) {
  .weather-panel { max-width: 75vw; min-width: 120px; right: 2vw; padding: 12px 7px 12px 12px;}
}
.weather-panel.active { display: block; }
.weather-panel button { float:right; background:transparent; border: 0; font-size:1.18em; }
</style>
</head>
<body class="dusk-mode">
<div class="map-container">
  <div class="map-viewport">
    <div class="map-tiles-wrap" id="tilesWrap" style="background:#111;">
      <!-- Maps and overlays will be injected here by JS -->
    </div>
  </div>
  <div class="overlay-controls" id="overlayControls">
    <label><input type="radio" name="overlay" value="none" checked> No overlay</label>
    <label><input type="radio" name="overlay" value="clouds"> Clouds ‚òÅÔ∏è</label>
    <label><input type="radio" name="overlay" value="precipitation"> Precipitation üåßÔ∏è</label>
    <label><input type="radio" name="overlay" value="wind"> Wind üí®</label>
    <label><input type="radio" name="overlay" value="temp"> Temperature üå°Ô∏è</label>
  </div>
  <div class="top-buttons">
    <button class="mode-btn" id="duskBtn" title="Dusk Mode">üåÜ</button>
    <button class="mode-btn" id="dayBtn" title="Day Mode">üå§Ô∏è</button>
    <button class="mode-btn" id="zoomInBtn" title="Zoom In">Ôºã</button>
    <button class="mode-btn" id="zoomOutBtn" title="Zoom Out">Ôºç</button>
    <input id="placeInput" placeholder="Type place name">
    <button id="placeGo">Go</button>
    <input id="latLonInput" placeholder="Deg Min N/S, Deg Min E/W">
    <button id="latLonGo">Go</button>
    <div id="cursorLatLon">‚Äî</div>
    <button class="mode-btn" id="homeBtn" title="Home" style="margin-left:auto;">üè† Home</button>
  </div>
  <div class="weather-panel" id="weatherPanel">
    <button id="closePanel" aria-label="Close">&times;</button>
    <div id="panelContent"></div>
  </div>
</div>
<script>
const apikey = "5eeba413966ed394db4d2df220015db4";
const tilesWrap = document.getElementById("tilesWrap");
let viewWidth = window.innerWidth;
function addTileImgs(layerClass) {
  for(let i=0; i<3; ++i) {
    let img = document.createElement("img");
    img.className = layerClass;
    img.style.left = (i*100) + 'vw';
    img.style.top = '0';
    if (layerClass=="world-map") {
      img.src="https://upload.wikimedia.org/wikipedia/commons/8/80/World_map_-_low_resolution.svg";
      img.draggable = false;
      tilesWrap.appendChild(img);
    } else {
      img.src = '';
      img.draggable = false;
      img.dataset.tileIdx = i;
      img.style.zIndex = 50;
      img.classList.add('overlay-img','hidden');
      tilesWrap.appendChild(img);
    }
  }
}
addTileImgs("world-map");
addTileImgs("overlay-img clouds");
addTileImgs("overlay-img precipitation");
addTileImgs("overlay-img wind");
addTileImgs("overlay-img temp");
window.addEventListener("resize", ()=>{ viewWidth=window.innerWidth; updateMap(); updateOverlayImgs(); });

const overlayTypes = {
  'clouds':'clouds_new',
  'precipitation':'precipitation_new',
  'wind':'wind_new',
  'temp':'temp_new'
};
const overlayControls = document.getElementById("overlayControls");
let overlayState = "none";
overlayControls.addEventListener("change",e=>{
  overlayState=e.target.value;
  updateOverlayImgs();
});
function updateOverlayImgs() {
  ["clouds","precipitation","wind","temp"].forEach(type=>{
    Array.from(tilesWrap.querySelectorAll(`.overlay-img.${type}`)).forEach((img,i)=>{
        if (overlayState!==type) img.classList.add("hidden");
        else {
          img.classList.remove("hidden");
          img.src = `https://tile.openweathermap.org/map/${overlayTypes[type]}/0/${i}/0.png?appid=${apikey}`;
        }
    });
  });
  if (overlayState==="none") {
    Array.from(tilesWrap.querySelectorAll(`.overlay-img`)).forEach(img=>img.classList.add("hidden"));
  }
}
updateOverlayImgs();

let mapZoom = 1;
let panOffset = 0, dragStart = 0, panY = 0, isDragging = false;
function updateMap() {
    tilesWrap.style.transform = `scale(${mapZoom}) translateX(${(panOffset - viewWidth)/mapZoom}px) translateY(${panY/mapZoom}px)`;
    updateOverlayImgs();
}
function beginDrag(x){ isDragging = true; dragStart = x; tilesWrap.classList.add('dragging'); }
function moveDrag(x){ panOffset += x - dragStart; dragStart = x; updateMap(); }
function endDrag(){
    viewWidth = window.innerWidth;
    panOffset = ((panOffset % viewWidth) + viewWidth) % viewWidth;
    updateMap(); isDragging = false; tilesWrap.classList.remove('dragging');
}
tilesWrap.addEventListener('mousedown', function(e){ if (e.button===0 && !e.target.closest('.top-buttons')) { beginDrag(e.clientX); }});
window.addEventListener('mousemove', function(e){ if (isDragging) moveDrag(e.clientX); });
window.addEventListener('mouseup', function(){ if (isDragging) endDrag(); });
tilesWrap.addEventListener('touchstart', function(e){ if (!e.target.closest('.top-buttons') && e.touches.length === 1) { beginDrag(e.touches[0].clientX); }}, {passive:false});
tilesWrap.addEventListener('touchmove', function(e){ if (isDragging && e.touches.length === 1) { e.preventDefault(); moveDrag(e.touches[0].clientX); }}, {passive:false});
tilesWrap.addEventListener('touchend', function(e){ if (isDragging) endDrag(); }, {passive:false});

document.getElementById("zoomInBtn").onclick = () => { if (mapZoom < 4) { mapZoom += 0.25; updateMap(); } };
document.getElementById("zoomOutBtn").onclick = () => { if (mapZoom > 1) { mapZoom -= 0.25; updateMap(); } };

const duskBtn = document.getElementById("duskBtn"),
      dayBtn  = document.getElementById("dayBtn");
// Remove darkBtn logic
function setMode(mode) {
    document.body.classList.remove("dusk-mode", "day-mode");
    if (mode === "dusk") document.body.classList.add("dusk-mode");
    else document.body.classList.add("day-mode");
    localStorage.setItem("mode",mode);
}
duskBtn.onclick = ()=>setMode("dusk");
dayBtn.onclick  = ()=>setMode("day");
(function(){ let mode = localStorage.getItem("mode"); setMode(mode === "day" ? "day" : "dusk"); })();

const weatherPanel = document.getElementById("weatherPanel");
const panelContent = document.getElementById("panelContent");
const closePanel = document.getElementById("closePanel");
let currentMarker = null;
function showWeatherPanel(data, lat, lon) {
    const name = data?.name || '';
    const weather = data?.weather?.[0];
    let icon = weather?.icon ? `<img src="https://openweathermap.org/img/wn/${weather.icon}@2x.png" style="width:44px;height:44px;vertical-align:middle;">` : '';
    const desc = weather?.description || '';
    const temp = data?.main?.temp !== undefined ? Math.round(data.main.temp)+"¬∞C" : '‚Äî';
    const wind = data?.wind?.speed !== undefined ? (data.wind.speed + " m/s") : '‚Äî';
    const hum  = data?.main?.humidity !== undefined ? (data.main.humidity + "%") : '‚Äî';
    let coordsInfo = lat && lon ? `<div style="font-size:.87em;opacity:.78">${(+lat).toFixed(4)}, ${(lon).toFixed(4)}</div>` : '';
    panelContent.innerHTML = `<b style="font-size:1.2em">${icon}${name?name:"Lat/Lon"}</b> ${coordsInfo}
      <div>${desc}</div>
      <div>üå° Temp: <b>${temp}</b></div>
      <div>üíß Humidity: <b>${hum}</b></div>
      <div>üå¨ Wind: <b>${wind}</b></div>
    `;
    weatherPanel.classList.add("active");
}
closePanel.onclick = () => weatherPanel.classList.remove("active");
tilesWrap.addEventListener("click", function(e){
    if (e.target.closest('.top-buttons,.location-marker')) return;
    const ww = window.innerWidth;
    const r = tilesWrap.getBoundingClientRect();
    let xPx = (e.clientX - r.left) - panOffset;
    xPx = ((xPx % ww) + ww) % ww;
    const x = xPx / ww, y = (e.clientY - r.top) / r.height;
    const lon = x * 360 - 180, latRad = (0.5 - y) * Math.PI;
    const lat = (180 / Math.PI) * Math.atan(Math.sinh(latRad));
    fetchWeatherAndShow(lat, lon);
});
async function fetchWeatherAndShow(lat, lon) {
    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apikey}&units=metric`;
    let res = await fetch(url); let data = await res.json();
    showWeatherPanel(data, lat, lon);
    placeMarkerAt(lat, lon, data);
}
function placeMarkerAt(lat, lon, data) {
    const ww = window.innerWidth;
    const x = ((lon + 180) / 360) * 100;
    const latRad = Math.atanh(Math.sin(lat * Math.PI / 180));
    const y = (0.5 - latRad / Math.PI) * 100;
    if (currentMarker) currentMarker.remove();
    const marker = document.createElement("div");
    marker.className = "location-marker bounce";
    marker.style.top = y + "%";
    marker.style.left = x + "%";
    marker.textContent = data && data.main && data.main.temp!==undefined ? Math.round(data.main.temp) + "¬∞C" : "üìç";
    marker.title = data && data.weather && data.weather[0]?.main ? data.weather[0].main : (lat.toFixed(3)+","+lon.toFixed(3));
    currentMarker = marker;
    tilesWrap.appendChild(marker);
}
document.getElementById("placeGo").onclick = handlePlaceSearch;
document.getElementById("placeInput").onkeypress = function(e){ if (e.key==="Enter") handlePlaceSearch(); };
async function handlePlaceSearch() {
    let place = document.getElementById("placeInput").value.trim();
    if (!place) return;
    let url = "https://api.openweathermap.org/data/2.5/weather?q=" + encodeURIComponent(place) + "&appid=" + apikey + "&units=metric";
    let res = await fetch(url); let data = await res.json();
    if (!data.coord) { alert("Place not found"); return; }
    showWeatherPanel(data, data.coord.lat, data.coord.lon);
    placeMarkerAt(data.coord.lat, data.coord.lon, data);
}
document.getElementById("latLonGo").onclick = handleLatLonSearch;
document.getElementById("latLonInput").onkeypress = function(e){ if(e.key==="Enter") handleLatLonSearch(); };
async function handleLatLonSearch() {
    const value = document.getElementById("latLonInput").value.trim();
    const pattern = /([0-9]{1,3})[¬∞\s]*([0-9]{1,2}(?:\.\d+)?)[\'\s]*([NSns]),?\s*([0-9]{1,3})[¬∞\s]*([0-9]{1,2}(?:\.\d+)?)[\'\s]*([EWew])/;
    const match = value.match(pattern);
    if (!match) { alert("Format: 37 47.5 N, 122 25.2 W"); return; }
    let latDeg = parseFloat(match[1]), latMin = parseFloat(match[2]), latDir = match[3].toUpperCase();
    let lonDeg = parseFloat(match[4]), lonMin = parseFloat(match[5]), lonDir = match[6].toUpperCase();
    let lat = latDeg + (latMin / 60); if (latDir === "S") lat = -lat;
    let lon = lonDeg + (lonMin / 60); if (lonDir === "W") lon = -lon;
    fetchWeatherAndShow(lat, lon);
}
const cursorLatLon = document.getElementById("cursorLatLon");
tilesWrap.addEventListener("mousemove", function(e){
    const ww = window.innerWidth;
    const r = tilesWrap.getBoundingClientRect();
    let xPx = (e.clientX - r.left) - panOffset;
    xPx = ((xPx % ww) + ww) % ww;
    const x = xPx / ww;
    const y = (e.clientY - r.top) / r.height;
    if (x < 0 || x > 1 || y < 0 || y > 1) { cursorLatLon.textContent = '‚Äî'; return; }
    const lon = (x * 360 - 180).toFixed(2);
    const latRad = (0.5 - y) * Math.PI;
    const lat = ((180 / Math.PI) * Math.atan(Math.sinh(latRad))).toFixed(2);
    cursorLatLon.textContent = lat + "," + lon;
});
tilesWrap.addEventListener("mouseleave", ()=> cursorLatLon.textContent = "‚Äî");
// Home button action
document.getElementById("homeBtn").onclick = () => {
    window.location.href = "index.html";
};
</script>
</body>
</html>
